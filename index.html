<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bean Burrito Videos</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="dist/iziToast/css/iziToast.min.css">

    <meta content="Bean Burrito Videos" property="og:title">
    <meta content="Click a button to get a random video from the company folder (SOMETIMES SHIT WARNING)" property="og:description">
    <meta content="Bean Burrito" property="og:url">
    <meta content="https://beanburrito.tech/Burrito_Bean_990x725.jpg" property="og:image">

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>

<body>
    <div class="container">
        <a href="https://beanburrito.tech" class="return">Return to BeanBurrito</a>
        <div style="text-align: center;">
            <!-- <div style="display: flex; align-items: center;">
                <h1>Bean Burrito Videos</h1>
            </div> -->
            <p id="currentVideo">No Video Loaded</p>
        </div>
        <video id="randomVideoPlayer" class="video" controls loop></video>
        <div class="controls">
            <a href="videos.html">
                <button class="control-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                        class="bi bi-list-ul" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                    </svg>
                </button>
            </a>
            <button class="control-button" id="copybutton" onclick="copyVideo()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                    class="bi bi-clipboard-fill" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M10 1.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-1Zm-5 0A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5v1A1.5 1.5 0 0 1 9.5 4h-3A1.5 1.5 0 0 1 5 2.5v-1Zm-2 0h1v1A2.5 2.5 0 0 0 6.5 5h3A2.5 2.5 0 0 0 12 2.5v-1h1a2 2 0 0 1 2 2V14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V3.5a2 2 0 0 1 2-2Z" />
                </svg>
            </button>
            <p class="control-text" id="remainingText">N/A</p>
        </div>
        <button onclick="newVideo()" class="button">New Video</button>
    </div>


    <script src="js/videohandler.js"></script>
    <script src="dist/iziToast/js/iziToast.min.js" type="text/javascript"></script>

    <script>
        var videoPlayer = document.getElementById("randomVideoPlayer");
        var currentVideo = document.getElementById("currentVideo");
        var remainingText = document.getElementById("remainingText");

        async function newVideo() {
            try {

                await checkVideos()

                var videosString = localStorage.getItem("videos");

                var videos = JSON.parse(videosString) || ["https://raw.githubusercontent.com/Bean-Burrito-Tech/beanburrito-videos/main/car_magnet.mp4"];

                if (videos === null) {
                    throw new Error('Something went wrong, try again.');
                }

                var watchedVideos = JSON.parse(localStorage.getItem('watchedVideos')) || [];
                watchedVideos.push(videoPlayer.src)
                localStorage.setItem('watchedVideos', JSON.stringify(watchedVideos));


                var remainingVideos = videos.filter(function (video) {
                    return !watchedVideos.includes(video);
                });

                if (remainingVideos.length === 0) {
                    alert("You have watched every single video we have currently make sure to check back for more! In the meantime we will reset the videos you have watched.");
                    localStorage.setItem('watchedVideos', JSON.stringify([]));
                    return;
                }

                var randomVideo = remainingVideos[Math.floor(Math.random() * remainingVideos.length)];

                videoPlayer.src = randomVideo;
                videoPlayer.play();

                // currentVideo.textContent = `(#${videos.indexOf(randomVideo) + 1}) ${randomVideo.split('/')[6].split('.')[0].replace(/_/g, " ")}`;
                currentVideo.textContent = `${randomVideo.split('/')[6].split('.')[0].replace(/_/g, " ")}`;
                remainingText.textContent = `${remainingVideos.length - 1}`
            } catch (error) {
                console.error(error);
                iziToast.show({
                    title: 'Error',
                    message: 'Something went wrong, please try again.',
                    position: 'topRight',
                    color: 'red'
                });
            }
        }


        async function copyVideo() {
            navigator.clipboard.writeText(videoPlayer.src).then(() => {
                return iziToast.show({
                    title: 'Success',
                    message: 'Video successfully copied to clipboard!',
                    position: 'topRight',
                    color: 'green'
                });
            }, () => {
                return iziToast.show({
                    title: 'Error',
                    message: 'Something went wrong trying to copy the video.',
                    position: 'topRight',
                    color: 'red'
                });
            });
        }
    </script>
</body>

</html>