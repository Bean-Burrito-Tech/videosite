<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bean Burrito Videos</title>
    <!-- <link rel="stylesheet" href="css/style.css"> -->
    <link rel="stylesheet" href="css/style2.css">
    <link rel="stylesheet" href="dist/iziToast/css/iziToast.min.css">
    <link href="https://fonts.googleapis.com/css?family=Inter&amp;display=swap" rel="stylesheet">

    <meta content="Bean Burrito Videos" property="og:title">
    <meta content="Click a button to get a random video from the company folder (SOMETIMES SHIT WARNING)"
        property="og:description">
    <meta content="Bean Burrito" property="og:url">
    <meta content="https://beanburrito.tech/Burrito_Bean_990x725.jpg" property="og:image">

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>

<body>
    <div id="overlay">
        <div id="playPauseButton" class="player-button" onclick="togglePlayPause()" style="display: none; ">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
              </svg>
        </div>
        <img src="https://media.discordapp.net/attachments/1003531236570038434/1174101098672431215/image-removebg-preview.png" alt="Skibidi Gavin" id="loadingIndicator" class="overlay-loading" style="display: none;">
    </div>
    <div class="controls" id="blank">
        <div class="top">
            <p id="currentVideo" class="dropshadow">Click the + button or R key to load a new video.</p>
        </div>
        <div class="left">
            <a href="https://beanburrito.tech">
                <button class="controls-button">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-house-door-fill"
                        viewBox="0 0 16 16">
                        <path
                            d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5Z" />
                    </svg>
                </button>
            </a>
            <a href="videos.html">
                <button class="controls-button">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-list-ul"
                        viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                    </svg>
                </button>
            </a>
        </div>
        <div class="right">
            <button onclick="newVideo()" class="controls-button">
                <svg xmlns="http://www.w3.org/2000/svg" style="height: 40px; width: 40px;" fill="currentColor"
                    class="bi bi-plus" viewBox="0 0 16 16">
                    <path
                        d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                </svg>
            </button>
            <button class="controls-button" onclick="copyVideo()">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-clipboard-fill"
                    style="height: 18px; width: 18px;" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M10 1.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-1Zm-5 0A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5v1A1.5 1.5 0 0 1 9.5 4h-3A1.5 1.5 0 0 1 5 2.5v-1Zm-2 0h1v1A2.5 2.5 0 0 0 6.5 5h3A2.5 2.5 0 0 0 12 2.5v-1h1a2 2 0 0 1 2 2V14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V3.5a2 2 0 0 1 2-2Z" />
                </svg>
            </button>
            <p id="remainingText" class="dropshadow">N/A</p>

        </div>
        <div class="bottom">
            <div class="progress" id="progress">
                <div class="progress-filled" id="progressBar">
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <video id="randomVideoPlayer" class="video" loop playsinline></video>
    </div>

    <script src="js/videohandler.js"></script>
    <script src="js/videoplayer.js"></script>
    <script src="dist/iziToast/js/iziToast.min.js" type="text/javascript"></script>

    <script>
        var videoPlayer = document.getElementById("randomVideoPlayer");
        var currentVideo = document.getElementById("currentVideo");
        var remainingText = document.getElementById("remainingText");

        document.addEventListener('DOMContentLoaded', function () {
            var video = document.querySelector('.video');

            video.addEventListener('click', function () {
                if (video.paused) {
                    video.play();
                } else {
                    video.pause();
                }
            });
        });

        async function newVideo() {
            try {

                await checkVideos()

                var videosString = localStorage.getItem("videos");

                var videos = JSON.parse(videosString) || ["https://raw.githubusercontent.com/Bean-Burrito-Tech/beanburrito-videos/main/car_magnet.mp4"];

                if (videos === null) {
                    throw new Error('Something went wrong, try again.');
                }

                var watchedVideos = JSON.parse(localStorage.getItem('watchedVideos')) || [];

                var remainingVideos = videos.filter(function (video) {
                    return !watchedVideos.includes(video);
                });

                if (remainingVideos.length === 0) {
                    alert("You have watched every single video we have currently make sure to check back for more! In the meantime we will reset the videos you have watched.");
                    localStorage.setItem('watchedVideos', JSON.stringify([]));
                    return;
                }

                var randomVideo = remainingVideos[Math.floor(Math.random() * remainingVideos.length)];

                videoPlayer.src = randomVideo;
                videoPlayer.play();

                // currentVideo.textContent = `(#${videos.indexOf(randomVideo) + 1}) ${randomVideo.split('/')[6].split('.')[0].replace(/_/g, " ")}`;
                currentVideo.textContent = `${randomVideo.split('/')[6].split('.')[0].replace(/_/g, " ")}`;
                remainingText.textContent = `${remainingVideos.length - 1}`;

                watchedVideos.push(videoPlayer.src)
                localStorage.setItem('watchedVideos', JSON.stringify(watchedVideos));
            } catch (error) {
                console.error(error);
                iziToast.show({
                    title: 'Error',
                    message: 'Something went wrong.',
                    position: 'topRight',
                    color: 'red'
                });
            }
        }

        // keyup event
        document.addEventListener('keyup', logKey);

        function logKey(e) {
            if (e.code === "Space") {
                e.preventDefault();
                if (videoPlayer.src != "") {
                    togglePlayPause();
                }
            }
            else if (e.key === "r") {
                newVideo();
            }
        }

        async function copyVideo() {
            navigator.clipboard.writeText(videoPlayer.src).then(() => {
                return iziToast.show({
                    title: 'Success',
                    message: 'Video successfully copied to clipboard!',
                    position: 'topRight',
                    color: 'green'
                });
            }, () => {
                return iziToast.show({
                    title: 'Error',
                    message: 'Something went wrong trying to copy the video.',
                    position: 'topRight',
                    color: 'red'
                });
            });
        }
    </script>
</body>

</html>