<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Bean Burrito Videos</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="dist/iziToast/css/iziToast.min.css">
    <link href="https://fonts.googleapis.com/css?family=Inter&amp;display=swap" rel="stylesheet">

    <meta content="Bean Burrito Videos" property="og:title">
    <meta content="Click a button to get a random video from the company folder (SOMETIMES SHIT WARNING)"
        property="og:description">
    <meta content="Bean Burrito" property="og:url">
    <meta content="https://beanburrito.tech/Burrito_Bean_990x725.jpg" property="og:image">

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>

<body>
    <img src="assets/aris.png" alt="Picture of Aristornus" id="aris">
    <div id="overlay">
        <div id="playPauseButton" class="player-button" onclick="togglePlayPause()" style="display: none; ">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                <path
                    d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z" />
            </svg>
        </div>
        <img src="https://media.discordapp.net/attachments/1003531236570038434/1174101098672431215/image-removebg-preview.png"
            alt="Skibidi Gavin" id="loadingIndicator" class="overlay-loading" style="display: none;">
    </div>
    <div class="controls" id="blank">
        <div class="top">
            <p id="currentVideo" class="dropshadow">Click the + button or R key to load a new video.</p>
        </div>
        <div class="left">
            <a href="https://beanburrito.tech">
                <button class="controls-button">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-house-door-fill"
                        viewBox="0 0 16 16">
                        <path
                            d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5Z" />
                    </svg>
                </button>
            </a>
            <button class="controls-button" id="settingsButton">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-gear-fill" viewBox="0 0 16 16">
                    <path
                        d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z" />
                </svg>
            </button>
            <a href="videos.html">
                <button class="controls-button">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-list-ul"
                        viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                    </svg>
                </button>
            </a>
        </div>
        <div class="right">
            <button onclick="newVideo()" class="controls-button">
                <svg xmlns="http://www.w3.org/2000/svg" style="height: 40px; width: 40px;" fill="currentColor"
                    class="bi bi-plus" viewBox="0 0 16 16">
                    <path
                        d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                </svg>
            </button>
            <button class="controls-button" onclick="copyVideo()">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-clipboard-fill"
                    style="height: 18px; width: 18px;" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M10 1.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-1Zm-5 0A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5v1A1.5 1.5 0 0 1 9.5 4h-3A1.5 1.5 0 0 1 5 2.5v-1Zm-2 0h1v1A2.5 2.5 0 0 0 6.5 5h3A2.5 2.5 0 0 0 12 2.5v-1h1a2 2 0 0 1 2 2V14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V3.5a2 2 0 0 1 2-2Z" />
                </svg>
            </button>
            <p id="remainingText" class="dropshadow">N/A</p>

        </div>
        <div class="bottom">
            <div class="progress" id="progress">
                <div class="progress-filled" id="progressBar">
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <video id="randomVideoPlayer" class="video" loop playsinline></video>
    </div>

    <div class="settings" style="display: none;" id="settings">
        <button class="settings-close" id="settingsClose">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                <path
                    d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
            </svg>
        </button>
        <div class="settings-container">
            <button class="settings-button" id="clearWatched">Clear Watched Videos</button>
            <!-- slider  -->
            <div class="slider-container">
                <label for="rotation">Rotation</label>
                <input type="range" min="0" max="180" class="slider"  id="rotationSlider">
            </div>
        </div>
    </div>


    <script src="js/videohandler.js"></script>
    <script src="js/videoplayer.js"></script>

    <script src="dist/iziToast/js/iziToast.min.js" type="text/javascript"></script>

    <script>
        var videoPlayer = document.getElementById("randomVideoPlayer");
        var currentVideo = document.getElementById("currentVideo");
        var remainingText = document.getElementById("remainingText");

        document.addEventListener('DOMContentLoaded', function () {
            var video = document.querySelector('.video');

            video.addEventListener('click', function () {
                if (video.paused) {
                    video.play();
                } else {
                    video.pause();
                }
            });
        });

        async function newVideo() {
            try {

                await checkVideos()

                var videosString = localStorage.getItem("videos");

                var videos = JSON.parse(videosString) || ["https://raw.githubusercontent.com/Bean-Burrito-Tech/beanburrito-videos/main/car_magnet.mp4"];

                if (videos === null) {
                    throw new Error('Something went wrong, try again.');
                }

                var watchedVideos = JSON.parse(localStorage.getItem('watchedVideos')) || [];

                var remainingVideos = videos.filter(function (video) {
                    return !watchedVideos.includes(video);
                });

                if (remainingVideos.length === 0) {
                    alert("You have watched every single video we have currently make sure to check back for more! If you want to rewatch everything feel free to clear your watched videos in the settings.");
                    return;
                }

                var randomVideo = remainingVideos[Math.floor(Math.random() * remainingVideos.length)];

                videoPlayer.src = randomVideo;
                videoPlayer.play();

                // currentVideo.textContent = `(#${videos.indexOf(randomVideo) + 1}) ${randomVideo.split('/')[6].split('.')[0].replace(/_/g, " ")}`;
                currentVideo.textContent = `${randomVideo.split('/')[6].split('.')[0].replace(/_/g, " ")}`;
                remainingText.textContent = `${remainingVideos.length - 1}`;

                watchedVideos.push(videoPlayer.src)
                localStorage.setItem('watchedVideos', JSON.stringify(watchedVideos));
            } catch (error) {
                console.error(error);
                iziToast.show({
                    title: 'Error',
                    message: 'Something went wrong.',
                    position: 'topRight',
                    color: 'red'
                });
            }
        }

        // keyup event
        document.addEventListener('keyup', logKey);

        function logKey(e) {
            if (e.code === "Space") {
                e.preventDefault();
                if (videoPlayer.src != "") {
                    togglePlayPause();
                }
            }
            else if (e.key === "r") {
                newVideo();
            }
        }

        async function copyVideo() {
            navigator.clipboard.writeText(videoPlayer.src).then(() => {
                return iziToast.show({
                    title: 'Success',
                    message: 'Video successfully copied to clipboard!',
                    position: 'topRight',
                    color: 'green'
                });
            }, () => {
                return iziToast.show({
                    title: 'Error',
                    message: 'Something went wrong trying to copy the video.',
                    position: 'topRight',
                    color: 'red'
                });
            });
        }

        var sliding = false;

        // detect right click
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            if (!sliding) {
                sliding = true;
                alert('Uh oh... You summoned the dark evil gavin')

                videoPlayer.muted = true;

                var aris = document.getElementById("aris");
                aris.style.right = '0';

                var audio = new Audio('assets/sliding_concrete.mp3');
                audio.play();
            }
        });

        // Settings

        settingsButton.addEventListener('click', function () {
            settings.style.display = "flex";
        });

        document.getElementById('settingsClose').addEventListener('click', function () {
            settings.style.display = "none";
        });

        document.getElementById("clearWatched").addEventListener('click', function () {
            if (confirm("Are you sure you want to clear your watched videos?")) {
                try {
                    localStorage.setItem('watchedVideos', JSON.stringify([]));
                    iziToast.show({
                        title: 'Success',
                        message: 'Watched videos successfully cleared!',
                        position: 'topRight',
                        color: 'green'
                    });
                }
                catch (error) {
                    console.error(error);
                    iziToast.show({
                        title: 'Error',
                        message: 'Something went wrong.',
                        position: 'topRight',
                        color: 'red'
                    });
                }
            }
        });

        // get when the rotationSlider slider changes and the user lets go
        document.getElementById("rotationSlider").addEventListener('change', function () {
            var rotation = document.getElementById("rotationSlider").value;
            var html = document.getElementsByTagName('html')[0];
            // set the rotation
            html.style.setProperty('transform', 'rotate(' + rotation + 'deg)');
        });

    </script>
</body>

</html>